clear
new circuit.ecp basekv=13.2 pu=1.05 r1=1.210 x1=2.834 r0=3.961 x0=3.214

// Built-in loadshape is hourly for 24 hours
plot loadshape object=default

// The default growthshape cannot be plotted;
// it has npts=2, year=[1,20], mult=[1.025,1.025]

// There is no default Tshape

// The default spectrum cannot be plotted

// for daily PV fluctuations
New Loadshape.Cloud npts=86401 sinterval=1 csvfile=pcloud.csv action=normalize
plot loadshape object=Cloud
New Loadshape.Clear npts=86401 sinterval=1 csvfile=pclear.csv action=normalize
plot loadshape object=Clear

// for duty cycle
new loadshape.PVduty npts=2900 interval=(1.0 3600 /) mult=(File=PVLoadshape-1sec-2900pts.csv) Action=Normalize
plot loadshape object=PVduty


// normalized G and degrees Celsius for daylight hours, 1-minute steps
New Loadshape.MyIrrad npts=781 minterval=1 csvfile=irrad.csv
New Tshape.MyTemp npts=781 minterval=1 csvfile=temp.csv
plot tshape object=mytemp
plot loadshape object=myirrad

// for yearly
! this one has both P and Q, each is normalized
new loadshape.YearlyPQ npts=8760 interval=1.0 mult=(File=LoadShape5_P.csv)  Qmult=(File=LoadShape5_Q.csv) Action=Normalize
plot Loadshape object=YearlyPQ

new linecode.trunk nphases=3 units=mi r1=0.3061 x1=0.6270 r0=0.7735 x0=1.9373 c1=0 c0=0
new line.seg1 bus1=sourcebus bus2=bess len=0.2
new line.seg2 bus1=bess      bus2=pv   len=1.0
new line.seg3 bus1=pv        bus2=load len=1.0
new line.seg4 bus1=load      bus2=gen  len=0.5

new storage.bess1 bus1=bess kv=13.2 kw=1000
new storage.bess2 bus1=bess kv=13.2 kw=1000
~ daily=default duty=default yearly=default spectrum=pwm6

New PVSystem.pv1 bus1=pv kV=13.2 irradiance=1.0 pmpp=1000 kVA=1000 pf=1.00
New PVSystem.pv2 bus1=pv kV=13.2 irradiance=1.0 pmpp=1000 kVA=1000 pf=1.00
~ daily=default duty=default yearly=default spectrum=dc6
// ~ tdaily=default tduty= tyearly=

new load.load1 bus1=load kv=13.2 kw=2000
//~ growth=default // cvrcurve=
new load.load2 bus1=load kv=13.2 kw=2000
//~ daily=default duty=default yearly=default spectrum=pwm6

new generator.gen1 bus1=gen kv=13.2 kw=500
new generator.gen2 bus1=gen kv=13.2 kw=500
~ daily=default duty=default yearly=default spectrum=linear

Set Voltagebases=[13.2]
calcv
set maxcontroliter=100
Solve

